!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("angular")):"function"==typeof define&&define.amd?define(["angular"],t):e.angularHttpEtag=t(e.angular)}(this,function(e){"use strict";function t(e,t){return t={exports:{}},e(t,t.exports),t.exports}function n(){var t=this,n=["createCache","getCache"],r=["setItem","getItem","removeItem","removeAllItems"],o=n.concat(r),c={},i={},a="httpEtagCache",u={deepCopy:!1,cacheResponseData:!0,cacheService:"$cacheFactory",cacheOptions:{number:25}};t.setDefaultCacheConfig=function(n){return u=e.extend({},u,n),t},t.getDefaultCacheConfig=function(){return u},t.defineCache=function(n,r){return r=e.extend({},u,r,{id:n}),i[n]=r,t},t.defineCacheServiceAdapter=function(n,r){if(!r)throw new Error("Missing cache service adapter configuration");if(!r.methods)throw new Error("Missing cache service adapter configuration methods");return e.forEach(o,function(e){if("function"!=typeof r.methods[e])throw new Error('Expected cache service adapter method "'+e+'" to be a function')}),c[n]=r,t},t.getCacheServiceAdapter=function(e){return c[e]},t.$get=["$injector",function(o){function u(e){var t=typeof e,n="number"===t||"string"===t&&!!e;return n?e:a}var s={},l={},p={},h={},d={};return i[a]||t.defineCache(a),e.forEach(c,function(t,r){var c=l[r]=window[r]||o.get(r),i=p[r]={};e.forEach(n,function(n){i[n]=e.bind({},t.methods[n],c)})}),e.forEach(i,function(t,n){p[t.cacheService].createCache(n,t);var o=h[n]=p[t.cacheService].getCache(n),a=d[n]={},u=c[t.cacheService].config.storesDeepCopies,l=!u&&i[n].deepCopy,v=function(e){return l?f(e):e};e.forEach(r,function(n){var r,i,u=c[t.cacheService].methods[n];"getItem"===n&&(r=function(e,t,n){var r=u(e,t,n);return r&&v(r.responseData)},i=function(e,t,n){return v(u(e,t,n))}),"setItem"===n&&(r=function(e,t,n,r){var o=a.$getItem(t);n=v(n),o&&"object"==typeof o?(o.responseData=n,n=o):n={responseData:n},u(e,t,n,r)},i=function(e,t,n,r){u(e,t,v(n),r)}),a[n]=e.bind({},r||u,o),i&&(a["$"+n]=e.bind({},i,o))}),a.unsetItem=function(e){a.setItem(e,void 0)},a.expireItem=function(e){var t=a.$getItem(e);delete t.etagHeader,a.$setItem(e,t)},a.getItemCache=function(e){return s.getItemCache(n,e)},a.info=function(){return i[n]},a.isCache=!0}),s.info=function(){return i},s.getCache=function(e){var t=d[u(e)];if(t)return t},s.getItemCache=function(t,n){var r=s.getCache(t),o={};if(r){var c=[["set","setItem"],["get","getItem"],["$set","$setItem"],["$get","$getItem"],["unset","unsetItem"],["expire","expireItem"],["remove","removeItem"]];return e.forEach(c,function(t){o[t[0]]=e.bind({},r[t[1]],n)}),o.info=function e(){var e=r.info();return e.itemKey=n,e},o.isItemCache=!0,o}},s.purgeCaches=function(){e.forEach(d,function(e){e.removeAllItems()})},s}]}function r(t,n){function o(t){function o(e){var n=e.then,r=e.success;return a?e.cached=function(n){return m&&g.cacheResponseData&&n(b,"cached",void 0,t,v),e}:e.cached=function(){throw new Error("The method `cached` on the promise returned from `$http` has been disabled.")},e.ifCached=function(n){return m&&g.cacheResponseData&&n({data:b,status:"cached",headers:void 0,config:t},v),e},e.then=function(t,r,c){function i(e){return t(e,v)}function a(e){return r(e,v)}var u=n.apply(e,[t?i:void 0,r?a:void 0,c]);return o(u)},a&&v&&(e.success=function(t){var n=u(t,void 0,void 0,void 0,void 0,v);return r.apply(e,[n])}),e}var i,a=r.useLegacyPromiseExtensions(),l=!!t.etagCache,p=s.indexOf(t.method)>=0,h=l&&p;if(h){var d=c(t);if(d){var v=n.getItemCache(d.id,d.itemKey);if(!v)throw new Error("No defined ETag caches match specified cache ID");var g=v.info(),m=v.$get(),y=m&&m.etagHeader,b=y&&m.responseData;t.$$_itemCache=v,y&&(t.headers=e.extend({},t.headers,{"If-None-Match":y}))}}return i=f.apply(f,arguments),o(i),i}function c(e){var t=e.etagCache,n=typeof t,r={};if("function"===n&&(t=t(e),n=typeof t),"object"===n){var o,c;t.isCache?(o=t.info().id,c=i(e)):t.isItemCache?(o=t.info().id,c=t.info().itemKey):(o=t.id,c=t.itemKey||i(e)),r.id=o,r.itemKey=c}else if("string"===n)r.id=t,r.itemKey=i(e);else{if(t!==!0)return;r.itemKey=i(e)}return r}function i(e){var t=e.url,n=a(e.params),r=n&&t.indexOf("?")>0?"&":"?",o=n&&r+n||"";return t+o}function a(t){return t?O(j(t).sort(),function(n){var r=t[n];return e.isArray(r)?O(r.sort(),function(e){return encodeURIComponent(n)+"="+encodeURIComponent(e)}).join("&"):encodeURIComponent(n)+"="+encodeURIComponent(r)}).join("&"):""}function u(e){var t=Array.prototype.slice.call(arguments,1);return function(){for(var n=0,r=0;r<t.length&&n<arguments.length;r++)void 0===t[r]&&(t[r]=arguments[n++]);return e.apply(this,t)}}var f=t,s=["GET","JSONP"];return e.forEach(s,function(t){var n=t.toLowerCase();o[n]=function(n,r){return r=e.extend({},r,{method:t,url:n}),o.call(f,r)}}),e.forEach(f,function(e,t){o[t]||(o[t]=e)}),o}function o(){function e(e){var t=e.config.$$_itemCache;if(t){var n=t.info(),r=n.cacheResponseData,o=e.headers().etag,c={};o&&(c.etagHeader=o,r&&(c.responseData=e.data),t.$set(c)),delete e.config.$$_itemCache}return e}return{response:e}}function c(t){t.defineCacheServiceAdapter("$cacheFactory",{config:{storesDeepCopies:!1},methods:{createCache:function(e,t,n){e(t,n)},getCache:function(e,t){return e.get(t)},setItem:function(e,t,n){e.put(t,n)},getItem:function(e,t){return e.get(t)},removeItem:function(e,t){e.remove(t)},removeAllItems:function(e,t){e.removeAll()}}}).defineCacheServiceAdapter("localStorage",{config:{storesDeepCopies:!0},methods:{createCache:e.noop,getCache:function(e,t){return t},setItem:function(e,t,n){try{t=e+":"+t,localStorage.setItem(t,JSON.stringify(n))}catch(e){}},getItem:function(e,t){return t=e+":"+t,JSON.parse(localStorage.getItem(t))},removeItem:function(e,t){t=e+":"+t,localStorage.removeItem(t)},removeAllItems:function(t,n){var r=t+":";e.forEach(localStorage,function(e,t){0===t.indexOf(r)&&localStorage.removeItem(t)})}}}).defineCacheServiceAdapter("sessionStorage",{config:{storesDeepCopies:!0},methods:{createCache:e.noop,getCache:function(e,t){return t},setItem:function(e,t,n){try{t=e+":"+t,sessionStorage.setItem(t,JSON.stringify(n))}catch(e){}},getItem:function(e,t){return t=e+":"+t,JSON.parse(sessionStorage.getItem(t))},removeItem:function(e,t){t=e+":"+t,sessionStorage.removeItem(t)},removeAllItems:function(t,n){var r=t+":";e.forEach(sessionStorage,function(e,t){0===t.indexOf(r)&&sessionStorage.removeItem(t)})}}})}e="default"in e?e.default:e;var i=t(function(e,t){function n(e,t){if("[object Array]"!==r.call(e))throw new TypeError("array must be an Array");var n=void 0,o=void 0,c=void 0;for(n=0,o=e.length;n<o;++n)if(c=e[n],c===t||c!==c&&t!==t)return n;return-1}t.__esModule=!0;var r=Object.prototype.toString,o="undefined"!=typeof Buffer?function(e){return Buffer.isBuffer(e)}:function(){return!1},c="function"==typeof Object.keys?function(e){return Object.keys(e)}:function(e){var t=typeof e;if(null===e||"function"!==t&&"object"!==t)throw new TypeError("obj must be an Object");var n=[],r=void 0;for(r in e)Object.prototype.hasOwnProperty.call(e,r)&&n.push(r);return n},i="function"==typeof Symbol?function(e){return Object.getOwnPropertySymbols(e)}:function(){return[]};t.getKeys=c,t.getSymbols=i,t.indexOf=n,t.isBuffer=o}),a=t(function(e,t){function n(e,t){var n=o(e);return null!==n?n:r(e,t)}function r(e,t){if("function"!=typeof t)throw new TypeError("customizer is must be a Function");if("function"==typeof e){var n=String(e);return/^\s*function\s*\S*\([^\)]*\)\s*{\s*\[native code\]\s*}/.test(n)?e:new Function("return "+String(n))()}var r=a.call(e);if("[object Array]"===r)return[];if("[object Object]"===r&&e.constructor===Object)return{};if("[object Date]"===r)return new Date(e.getTime());if("[object RegExp]"===r){var o=String(e),i=o.lastIndexOf("/");return new RegExp(o.slice(1,i),o.slice(i+1))}if((0,c.isBuffer)(e)){var u=new Buffer(e.length);return e.copy(u),u}var f=t(e);return void 0!==f?f:null}function o(e){var t=typeof e;return null!==e&&"object"!==t&&"function"!==t?e:null}t.__esModule=!0,t.copyValue=t.copyCollection=t.copy=void 0;var c=i,a=Object.prototype.toString;t.copy=n,t.copyCollection=r,t.copyValue=o}),u=t(function(e,t){function n(e){}function r(e){var t=arguments.length<=1||void 0===arguments[1]?n:arguments[1];if(null===e)return null;var r=(0,c.copyValue)(e);if(null!==r)return r;var i=(0,c.copyCollection)(e,t),a=null!==i?i:e,u=[e],f=[a];return o(e,t,a,u,f)}function o(e,t,n,r,i){if(null===e)return null;var a=(0,c.copyValue)(e);if(null!==a)return a;var f=(0,u.getKeys)(e).concat((0,u.getSymbols)(e)),s=void 0,l=void 0,p=void 0,h=void 0,d=void 0,v=void 0,g=void 0,m=void 0;for(s=0,l=f.length;s<l;++s)p=f[s],h=e[p],d=(0,u.indexOf)(r,h),v=void 0,g=void 0,m=void 0,d===-1?(v=(0,c.copy)(h,t),g=null!==v?v:h,null!==h&&/^(?:function|object)$/.test(typeof h)&&(r.push(h),i.push(g))):m=i[d],n[p]=m||o(h,t,g,r,i);return n}t.__esModule=!0;var c=a,u=i;t.default=r,e.exports=t.default}),f=u,s=Object.prototype.toString,l=function(e){var t=s.call(e),n="[object Arguments]"===t;return n||(n="[object Array]"!==t&&null!==e&&"object"==typeof e&&"number"==typeof e.length&&e.length>=0&&"[object Function]"===s.call(e.callee)),n},p=Object.prototype.hasOwnProperty,h=Object.prototype.toString,d=Array.prototype.slice,v=l,g=Object.prototype.propertyIsEnumerable,m=!g.call({toString:null},"toString"),y=g.call(function(){},"prototype"),b=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],I=function(e){var t=e.constructor;return t&&t.prototype===e},C={$console:!0,$external:!0,$frame:!0,$frameElement:!0,$frames:!0,$innerHeight:!0,$innerWidth:!0,$outerHeight:!0,$outerWidth:!0,$pageXOffset:!0,$pageYOffset:!0,$parent:!0,$scrollLeft:!0,$scrollTop:!0,$scrollX:!0,$scrollY:!0,$self:!0,$webkitIndexedDB:!0,$webkitStorageInfo:!0,$window:!0},$=function(){if("undefined"==typeof window)return!1;for(var e in window)try{if(!C["$"+e]&&p.call(window,e)&&null!==window[e]&&"object"==typeof window[e])try{I(window[e])}catch(e){return!0}}catch(e){return!0}return!1}(),w=function(e){if("undefined"==typeof window||!$)return I(e);try{return I(e)}catch(e){return!1}},S=function(e){var t=null!==e&&"object"==typeof e,n="[object Function]"===h.call(e),r=v(e),o=t&&"[object String]"===h.call(e),c=[];if(!t&&!n&&!r)throw new TypeError("Object.keys called on a non-object");var i=y&&n;if(o&&e.length>0&&!p.call(e,0))for(var a=0;a<e.length;++a)c.push(String(a));if(r&&e.length>0)for(var u=0;u<e.length;++u)c.push(String(u));else for(var f in e)i&&"prototype"===f||!p.call(e,f)||c.push(String(f));if(m)for(var s=w(e),l=0;l<b.length;++l)s&&"constructor"===b[l]||!p.call(e,b[l])||c.push(b[l]);return c};S.shim=function(){if(Object.keys){var e=function(){return 2===(Object.keys(arguments)||"").length}(1,2);if(!e){var t=Object.keys;Object.keys=function(e){return t(v(e)?d.call(e):e)}}}else Object.keys=S;return Object.keys||S};var j=S,O=function(e,t){if(e.map)return e.map(t);for(var n=[],r=0;r<e.length;r++){var o=e[r];E.call(e,r)&&n.push(t(o,r,e))}return n},E=Object.prototype.hasOwnProperty;r.$inject=["$delegate","httpEtag"],c.$inject=["httpEtagProvider"];var x=e.module("http-etag",[]).provider("httpEtag",n).config(c).config(["$provide","$httpProvider",function(e,t){r.useLegacyPromiseExtensions=t.useLegacyPromiseExtensions||function(){return!0},e.decorator("$http",r),t.interceptors.push(o)}]).name;return x});
//# sourceMappingURL=angular-http-etag.min.js.map
