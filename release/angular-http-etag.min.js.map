{"version":3,"file":null,"sources":["../src/service.js","../src/httpDecorator.js","../src/httpInterceptor.js","../src/cacheServiceAdapters.js","../node_modules/deepcopy/lib/polyfill.js","../node_modules/deepcopy/lib/copy.js","../node_modules/deepcopy/lib/index.js","../node_modules/deepcopy/index.js","../node_modules/object-keys/isArguments.js","../node_modules/object-keys/index.js","../node_modules/array-map/index.js","../src/index.js"],"sourcesContent":["import angular from 'angular'\r\nimport deepcopy from 'deepcopy'\r\n\r\nexport default httpEtagProvider\r\n\r\nfunction httpEtagProvider () {\r\n  var httpEtagProvider = this\r\n\r\n  var serviceAdapterMethods = [\r\n    'createCache',\r\n    'getCache'\r\n  ]\r\n\r\n  var cacheAdapterMethods = [\r\n    'setItem',\r\n    'getItem',\r\n    'removeItem',\r\n    'removeAllItems'\r\n    // info method hard-coded\r\n  ]\r\n\r\n  var requiredAdapterMethods = serviceAdapterMethods.concat(cacheAdapterMethods)\r\n\r\n  // Built-in adapters defined in ./cacheServiceAdapters.js\r\n  var cacheAdapters = {}\r\n  var cacheDefinitions = {}\r\n\r\n  // Cache config defaults\r\n  var defaultCacheId = 'httpEtagCache'\r\n  var defaultEtagCacheConfig = {\r\n    deepCopy: false,\r\n    cacheResponseData: true,\r\n    cacheService: '$cacheFactory',\r\n    cacheOptions: {\r\n      number: 25\r\n    }\r\n  }\r\n\r\n  /**\r\n   * SERVICE PROVIDER\r\n   * .setDefaultCacheConfig(config)\r\n   * .defineCache(cacheId, config)\r\n   * .defineCacheServiceAdapter(serviceName, config)\r\n   * .getCacheServiceAdapter(serviceName)\r\n   */\r\n\r\n  httpEtagProvider.setDefaultCacheConfig = function httpEtagSetDefaultCacheOptions (config) {\r\n    defaultEtagCacheConfig = angular.extend({}, defaultEtagCacheConfig, config)\r\n    return httpEtagProvider\r\n  }\r\n\r\n  httpEtagProvider.getDefaultCacheConfig = function httpEtagGetDefaultCacheOptions () {\r\n    return defaultEtagCacheConfig\r\n  }\r\n\r\n  httpEtagProvider.defineCache = function httpEtagDefineCache (cacheId, config) {\r\n    config = angular.extend({}, defaultEtagCacheConfig, config, { id: cacheId })\r\n    cacheDefinitions[cacheId] = config\r\n    return httpEtagProvider\r\n  }\r\n\r\n  httpEtagProvider.defineCacheServiceAdapter = function httpEtagDefineCacheServiceAdapter (serviceName, config) {\r\n    if (!config) throw new Error('Missing cache service adapter configuration')\r\n    if (!config.methods) throw new Error('Missing cache service adapter configuration methods')\r\n    angular.forEach(requiredAdapterMethods, function (method) {\r\n      if (typeof config.methods[method] !== 'function') {\r\n        throw new Error('Expected cache service adapter method \"' + method + '\" to be a function')\r\n      }\r\n    })\r\n\r\n    cacheAdapters[serviceName] = config\r\n    return httpEtagProvider\r\n  }\r\n\r\n  httpEtagProvider.getCacheServiceAdapter = function httpEtagGetCacheServiceAdapter (serviceName) {\r\n    return cacheAdapters[serviceName]\r\n  }\r\n\r\n  /**\r\n   * SERVICE\r\n   * .info()\r\n   * .getCache(acheId)\r\n   * .getItemCache(cacheId, itemKey)\r\n   */\r\n\r\n  httpEtagProvider.$get = ['$injector', function httpEtagFactory ($injector) {\r\n    var httpEtagService = {}\r\n\r\n    var services = {}\r\n    var adaptedServices = {}\r\n    var caches = {}\r\n    var adaptedCaches = {}\r\n\r\n    // Add default cache if not already defined\r\n    if (!cacheDefinitions[defaultCacheId]) httpEtagProvider.defineCache(defaultCacheId)\r\n\r\n    // Find/inject cache service and create adapted versions\r\n    angular.forEach(cacheAdapters, function adaptCacheService (adapter, serviceName) {\r\n      var service = services[serviceName] = window[serviceName] || $injector.get(serviceName)\r\n      var adaptedService = adaptedServices[serviceName] = {}\r\n\r\n      angular.forEach(serviceAdapterMethods, function (method) {\r\n        adaptedService[method] = angular.bind({}, adapter.methods[method], service)\r\n      })\r\n    })\r\n\r\n    // Instantiate caches and create adapted versions\r\n    angular.forEach(cacheDefinitions, function adaptCache (config, cacheId) {\r\n      adaptedServices[config.cacheService].createCache(cacheId, config)\r\n      var cache = caches[cacheId] = adaptedServices[config.cacheService].getCache(cacheId)\r\n      var adaptedCache = adaptedCaches[cacheId] = {}\r\n      // Determine whether to perform deepcopying or not\r\n      var serviceDeepCopies = cacheAdapters[config.cacheService].config.storesDeepCopies\r\n      var deepCopy = !serviceDeepCopies && cacheDefinitions[cacheId].deepCopy\r\n      var copy = function (value) {\r\n        return deepCopy ? deepcopy(value) : value\r\n      }\r\n\r\n      angular.forEach(cacheAdapterMethods, function (method) {\r\n        var adapterMethod = cacheAdapters[config.cacheService].methods[method]\r\n        var wrappedMethod\r\n        var wrappedRawMethod\r\n\r\n        // Wrap set/get methods to set/get to the `responseData` property of an\r\n        // object. This is where the $http interceptor stores response data.\r\n        if (method === 'getItem') {\r\n          wrappedMethod = function getCacheItemResponseData (cache, itemKey, options) {\r\n            var cachedData = adapterMethod(cache, itemKey, options)\r\n            return cachedData && copy(cachedData.responseData)\r\n          }\r\n\r\n          wrappedRawMethod = function getCacheItemData (cache, itemKey, options) {\r\n            return copy(adapterMethod(cache, itemKey, options))\r\n          }\r\n        }\r\n\r\n        if (method === 'setItem') {\r\n          wrappedMethod = function setCacheItemResponseData (cache, itemKey, value, options) {\r\n            var cachedData = adaptedCache.$getItem(itemKey)\r\n            value = copy(value)\r\n\r\n            if (cachedData && typeof cachedData === 'object') {\r\n              cachedData.responseData = value\r\n              value = cachedData\r\n            } else value = { responseData: value }\r\n\r\n            adapterMethod(cache, itemKey, value, options)\r\n          }\r\n\r\n          wrappedRawMethod = function setCacheItemData (cache, itemKey, value, options) {\r\n            adapterMethod(cache, itemKey, copy(value), options)\r\n          }\r\n        }\r\n\r\n        adaptedCache[method] = angular.bind({}, (wrappedMethod || adapterMethod), cache)\r\n        if (wrappedRawMethod) {\r\n          adaptedCache['$' + method] = angular.bind({}, wrappedRawMethod, cache)\r\n        }\r\n      })\r\n\r\n      adaptedCache.unsetItem = function adaptedCacheUnsetItemCache (itemKey) {\r\n        adaptedCache.setItem(itemKey, undefined)\r\n      }\r\n      adaptedCache.expireItem = function adaptedCacheUnsetItemCache (itemKey) {\r\n        var data = adaptedCache.$getItem(itemKey)\r\n        delete data.etagHeader\r\n        adaptedCache.$setItem(itemKey, data)\r\n      }\r\n      adaptedCache.getItemCache = function adaptedCacheGetItemCache (itemKey) {\r\n        return httpEtagService.getItemCache(cacheId, itemKey)\r\n      }\r\n      adaptedCache.info = function adaptedCacheInfo () {\r\n        return cacheDefinitions[cacheId]\r\n      }\r\n      adaptedCache.isCache = true\r\n    })\r\n\r\n    httpEtagService.info = function httpEtagServiceInfo () {\r\n      return cacheDefinitions\r\n    }\r\n\r\n    httpEtagService.getCache = function httpEtagServiceGetCache (cacheId) {\r\n      var cache = adaptedCaches[processCacheId(cacheId)]\r\n      if (cache) return cache\r\n    }\r\n\r\n    httpEtagService.getItemCache = function httpEtagServiceGeItemCache (cacheId, itemKey) {\r\n      var cache = httpEtagService.getCache(cacheId)\r\n      var itemCache = {}\r\n      if (!cache) return\r\n\r\n      var methodMappings = [\r\n        ['set', 'setItem'],\r\n        ['get', 'getItem'],\r\n        ['$set', '$setItem'],\r\n        ['$get', '$getItem'],\r\n        ['unset', 'unsetItem'],\r\n        ['expire', 'expireItem'],\r\n        ['remove', 'removeItem']\r\n      ]\r\n\r\n      angular.forEach(methodMappings, function mapCacheMethdodsToItemCache (methods) {\r\n        itemCache[methods[0]] = angular.bind({}, cache[methods[1]], itemKey)\r\n      })\r\n\r\n      itemCache.info = function itemCacheInfo () {\r\n        var itemCacheInfo = cache.info()\r\n        itemCacheInfo.itemKey = itemKey\r\n        return itemCacheInfo\r\n      }\r\n\r\n      itemCache.isItemCache = true\r\n\r\n      return itemCache\r\n    }\r\n\r\n    httpEtagService.purgeCaches = function httpEtagPurgeCaches () {\r\n      angular.forEach(adaptedCaches, function (cache) {\r\n        cache.removeAllItems()\r\n      })\r\n    }\r\n\r\n    function processCacheId (cacheId) {\r\n      var type = typeof cacheId\r\n      var isDefined = type === 'number' || (type === 'string' && !!cacheId)\r\n      return isDefined ? cacheId : defaultCacheId\r\n    }\r\n\r\n    return httpEtagService\r\n  }]\r\n}\r\n","import angular from 'angular'\r\nimport objectKeys from 'object-keys'\r\nimport arrayMap from 'array-map'\r\n\r\nexport default httpEtagHttpDecorator\r\n\r\nhttpEtagHttpDecorator.$inject = ['$delegate', 'httpEtag']\r\n\r\nfunction httpEtagHttpDecorator ($delegate, httpEtag) {\r\n  var $http = $delegate\r\n  var cachableHttpMethods = [\r\n    'GET',\r\n    'JSONP'\r\n  ]\r\n\r\n  function $httpDecorator (httpConfig) {\r\n    var useLegacyPromiseExtensions = httpEtagHttpDecorator.useLegacyPromiseExtensions()\r\n    var hasConfig = !!httpConfig.etagCache\r\n    var isCacheableMethod = cachableHttpMethods.indexOf(httpConfig.method) >= 0\r\n    var isCachable = hasConfig && isCacheableMethod\r\n    var httpPromise\r\n\r\n    if (isCachable) {\r\n      var etagCacheConfig = processHttpConfigEtagValue(httpConfig)\r\n      if (etagCacheConfig) {\r\n        var itemCache = httpEtag.getItemCache(etagCacheConfig.id, etagCacheConfig.itemKey)\r\n        if (!itemCache) throw new Error('No defined ETag caches match specified cache ID')\r\n\r\n        var cacheInfo = itemCache.info()\r\n        var rawCacheData = itemCache.$get()\r\n        var cachedEtag = rawCacheData && rawCacheData.etagHeader\r\n        var cachedResponse = cachedEtag && rawCacheData.responseData\r\n\r\n        // Allow easy access to cache in interceptor\r\n        httpConfig.$$_itemCache = itemCache\r\n\r\n        if (cachedEtag) {\r\n          httpConfig.headers = angular.extend({}, httpConfig.headers, {\r\n            'If-None-Match': cachedEtag\r\n          })\r\n        }\r\n      }\r\n    }\r\n\r\n    httpPromise = $http.apply($http, arguments)\r\n    httpEtagPromiseFactory(httpPromise)\r\n\r\n    function httpEtagPromiseFactory (httpPromise) {\r\n      var then = httpPromise.then\r\n      var success = httpPromise.success\r\n\r\n      httpPromise.cached = function httpEtagPromiseCached (callback) {\r\n        if (isCachable && rawCacheData && cacheInfo.cacheResponseData) {\r\n          if(useLegacyPromiseExtensions) {\r\n            callback(cachedResponse, 'cached', undefined, httpConfig, itemCache)\r\n          } else {\r\n            callback({\r\n              data: cachedResponse,\r\n              status: 'cached',\r\n              headers: undefined,\r\n              config: httpConfig\r\n            }, itemCache)\r\n          }  \r\n        }\r\n        return httpPromise\r\n      }\r\n\r\n      httpPromise.then = function httpEtagThenWrapper (successCallback, errorCallback, progressBackCallback) {\r\n        var thenPromise = then.apply(httpPromise, [\r\n          successCallback ? httpEtagSuccessWrapper : undefined,\r\n          errorCallback ? httpEtagErrorWrapper : undefined,\r\n          progressBackCallback\r\n        ])\r\n\r\n        function httpEtagSuccessWrapper (response) {\r\n          return successCallback(response, itemCache)\r\n        }\r\n\r\n        function httpEtagErrorWrapper (response) {\r\n          return errorCallback(response, itemCache)\r\n        }\r\n\r\n        return httpEtagPromiseFactory(thenPromise)\r\n      }\r\n\r\n      if (useLegacyPromiseExtensions && itemCache) {\r\n        httpPromise.success = function httpEtagPromiseSuccess (callback) {\r\n          var partializedCallback = partial(callback, undefined, undefined, undefined, undefined, itemCache)\r\n          return success.apply(httpPromise, [partializedCallback])\r\n        }\r\n      }\r\n\r\n      return httpPromise\r\n    }\r\n\r\n    return httpPromise\r\n  }\r\n\r\n  // Decorate the cachable shortcut methods, too\r\n  angular.forEach(cachableHttpMethods, function (httpMethod) {\r\n    var method = httpMethod.toLowerCase()\r\n    $httpDecorator[method] = function httpEtagHttpShortcutWrapper (url, config) {\r\n      config = angular.extend({}, config, {\r\n        method: httpMethod,\r\n        url: url\r\n      })\r\n\r\n      return $httpDecorator.call($http, config)\r\n    }\r\n  })\r\n\r\n  // Copy over all other properties and methods\r\n  angular.forEach($http, function copyHttpPropertyToDectorator (value, key) {\r\n    if (!$httpDecorator[key]) $httpDecorator[key] = value\r\n  })\r\n\r\n  /**\r\n   * HELPERS\r\n   */\r\n\r\n  function processHttpConfigEtagValue (httpConfig) {\r\n    var etagValue = httpConfig.etagCache\r\n    var etagValueType = typeof etagValue\r\n    var etagCacheConfig = {}\r\n\r\n    // Evaluate function first\r\n    if (etagValueType === 'function') {\r\n      etagValue = etagValue(httpConfig)\r\n      etagValueType = typeof etagValue\r\n    }\r\n\r\n    // Plain, cache, or itemCache objects\r\n    if (etagValueType === 'object') {\r\n      var id, itemKey\r\n\r\n      if (etagValue.isCache) {\r\n        id = etagValue.info().id\r\n        itemKey = generateCacheItemKey(httpConfig)\r\n      } else if (etagValue.isItemCache) {\r\n        id = etagValue.info().id\r\n        itemKey = etagValue.info().itemKey\r\n      } else {\r\n        id = etagValue.id\r\n        itemKey = etagValue.itemKey || generateCacheItemKey(httpConfig)\r\n      }\r\n\r\n      etagCacheConfig.id = id\r\n      etagCacheConfig.itemKey = itemKey\r\n    } else if (etagValueType === 'string') {\r\n      etagCacheConfig.id = etagValue\r\n      etagCacheConfig.itemKey = generateCacheItemKey(httpConfig)\r\n    } else if (etagValue === true) {\r\n      // Undefined cacheId will use the default cacheId as defined in provider\r\n      etagCacheConfig.itemKey = generateCacheItemKey(httpConfig)\r\n    } else return\r\n    return etagCacheConfig\r\n  }\r\n\r\n  function generateCacheItemKey (httpConfig) {\r\n    var url = httpConfig.url\r\n    var params = stringifyParams(httpConfig.params)\r\n    var joiner = ((params && url.indexOf('?') > 0) ? '&' : '?')\r\n    var queryString = (params && joiner + params) || ''\r\n    return url + queryString\r\n  }\r\n\r\n  // Based on npm package \"query-string\"\r\n  function stringifyParams (obj) {\r\n    return obj ? arrayMap(objectKeys(obj).sort(), function (key) {\r\n      var val = obj[key]\r\n\r\n      if (angular.isArray(val)) {\r\n        return arrayMap(val.sort(), function (val2) {\r\n          return encodeURIComponent(key) + '=' + encodeURIComponent(val2)\r\n        }).join('&')\r\n      }\r\n\r\n      return encodeURIComponent(key) + '=' + encodeURIComponent(val)\r\n    }).join('&') : ''\r\n  }\r\n\r\n  // http://ejohn.org/blog/partial-functions-in-javascript/\r\n  function partial (fn) {\r\n    var args = Array.prototype.slice.call(arguments, 1)\r\n    return function () {\r\n      var arg = 0\r\n      for (var i = 0; i < args.length && arg < arguments.length; i++) {\r\n        if (args[i] === undefined) args[i] = arguments[arg++]\r\n      }\r\n      return fn.apply(this, args)\r\n    }\r\n  }\r\n\r\n  return $httpDecorator\r\n}\r\n","export default httpEtagInterceptorFactory\r\n\r\nfunction httpEtagInterceptorFactory () {\r\n  function responseInterceptor (response) {\r\n    var itemCache = response.config.$$_itemCache\r\n\r\n    if (itemCache) {\r\n      var cacheInfo = itemCache.info()\r\n      var cacheResponseData = cacheInfo.cacheResponseData\r\n      var etag = response.headers().etag\r\n      var cacheData = {}\r\n\r\n      if (etag) {\r\n        cacheData.etagHeader = etag\r\n        if (cacheResponseData) cacheData.responseData = response.data\r\n        itemCache.$set(cacheData)\r\n      }\r\n\r\n      delete response.config.$$_itemCache\r\n    }\r\n\r\n    return response\r\n  }\r\n\r\n  return {\r\n    response: responseInterceptor\r\n  }\r\n}\r\n","import angular from 'angular'\r\n\r\nexport default cacheAdaptersConfig\r\n\r\ncacheAdaptersConfig.$inject = ['httpEtagProvider']\r\n\r\nfunction cacheAdaptersConfig (httpEtagProvider) {\r\n  httpEtagProvider\r\n\r\n    .defineCacheServiceAdapter('$cacheFactory', {\r\n      config: {\r\n        storesDeepCopies: false\r\n      },\r\n      methods: {\r\n        createCache: function createCache ($cacheFactory, cacheId, options) {\r\n          $cacheFactory(cacheId, options)\r\n        },\r\n        getCache: function getCache ($cacheFactory, cacheId) {\r\n          return $cacheFactory.get(cacheId)\r\n        },\r\n        setItem: function setItem (cache, itemKey, value) {\r\n          cache.put(itemKey, value)\r\n        },\r\n        getItem: function getItem (cache, itemKey) {\r\n          return cache.get(itemKey)\r\n        },\r\n        removeItem: function removeItem (cache, itemKey) {\r\n          cache.remove(itemKey)\r\n        },\r\n        removeAllItems: function removeAllItems (cache, itemKey) {\r\n          cache.removeAll()\r\n        }\r\n      }\r\n    })\r\n\r\n    .defineCacheServiceAdapter('localStorage', {\r\n      config: {\r\n        storesDeepCopies: true\r\n      },\r\n      methods: {\r\n        createCache: angular.noop,\r\n        getCache: function getCache (localStorage, cacheId) {\r\n          return cacheId\r\n        },\r\n        setItem: function setItem (cacheId, itemKey, value) {\r\n          try {\r\n            itemKey = cacheId + ':' + itemKey\r\n            localStorage.setItem(itemKey, JSON.stringify(value))\r\n          } catch (e) {\r\n\r\n          }\r\n        },\r\n        getItem: function getItem (cacheId, itemKey) {\r\n          itemKey = cacheId + ':' + itemKey\r\n          return JSON.parse(localStorage.getItem(itemKey))\r\n        },\r\n        removeItem: function removeItem (cacheId, itemKey) {\r\n          itemKey = cacheId + ':' + itemKey\r\n          localStorage.removeItem(itemKey)\r\n        },\r\n        removeAllItems: function removeAllItems (cacheId, itemKey) {\r\n          var keyPrefix = cacheId + ':'\r\n\r\n          angular.forEach(localStorage, function (value, key) {\r\n            if (key.indexOf(keyPrefix) === 0) {\r\n              localStorage.removeItem(key)\r\n            }\r\n          })\r\n        }\r\n      }\r\n    })\r\n\r\n    .defineCacheServiceAdapter('sessionStorage', {\r\n      config: {\r\n        storesDeepCopies: true\r\n      },\r\n      methods: {\r\n        createCache: angular.noop,\r\n        getCache: function getCache (sessionStorage, cacheId) {\r\n          return cacheId\r\n        },\r\n        setItem: function setItem (cacheId, itemKey, value) {\r\n          try {\r\n            itemKey = cacheId + ':' + itemKey\r\n            sessionStorage.setItem(itemKey, JSON.stringify(value))\r\n          } catch (e) {\r\n\r\n          }\r\n        },\r\n        getItem: function getItem (cacheId, itemKey) {\r\n          itemKey = cacheId + ':' + itemKey\r\n          return JSON.parse(sessionStorage.getItem(itemKey))\r\n        },\r\n        removeItem: function removeItem (cacheId, itemKey) {\r\n          itemKey = cacheId + ':' + itemKey\r\n          sessionStorage.removeItem(itemKey)\r\n        },\r\n        removeAllItems: function removeAllItems (cacheId, itemKey) {\r\n          var keyPrefix = cacheId + ':'\r\n\r\n          angular.forEach(sessionStorage, function (value, key) {\r\n            if (key.indexOf(keyPrefix) === 0) {\r\n              sessionStorage.removeItem(key)\r\n            }\r\n          })\r\n        }\r\n      }\r\n    })\r\n}\r\n","'use strict';\n\nexports.__esModule = true;\nvar toString = Object.prototype.toString;\n\nvar isBuffer = typeof Buffer !== 'undefined' ? function isBuffer(obj) {\n  return Buffer.isBuffer(obj);\n} : function isBuffer() {\n  // always return false in browsers\n  return false;\n};\n\nvar getKeys = typeof Object.keys === 'function' ? function getKeys(obj) {\n  return Object.keys(obj);\n} : function getKeys(obj) {\n  var objType = typeof obj;\n\n  if (obj === null || objType !== 'function' && objType !== 'object') {\n    throw new TypeError('obj must be an Object');\n  }\n\n  var resultKeys = [],\n      key = void 0;\n\n  for (key in obj) {\n    Object.prototype.hasOwnProperty.call(obj, key) && resultKeys.push(key);\n  }\n\n  return resultKeys;\n};\n\nvar getSymbols = typeof Symbol === 'function' ? function getSymbols(obj) {\n  return Object.getOwnPropertySymbols(obj);\n} : function getSymbols() {\n  // always return empty Array when Symbol is not supported\n  return [];\n};\n\n// NOTE:\n//\n//   Array.prototype.indexOf is cannot find NaN (in Chrome)\n//   Array.prototype.includes is can find NaN (in Chrome)\n//\n//   this function can find NaN, because use SameValue algorithm\nfunction indexOf(array, s) {\n  if (toString.call(array) !== '[object Array]') {\n    throw new TypeError('array must be an Array');\n  }\n\n  var i = void 0,\n      len = void 0,\n      value = void 0;\n\n  for (i = 0, len = array.length; i < len; ++i) {\n    value = array[i];\n\n    // NOTE:\n    //\n    //   it is SameValue algorithm\n    //   http://stackoverflow.com/questions/27144277/comparing-a-variable-with-itself\n    //\n    // eslint-disable-next-line no-self-compare\n    if (value === s || value !== value && s !== s) {\n      return i;\n    }\n  }\n\n  return -1;\n}\n\nexports.getKeys = getKeys;\nexports.getSymbols = getSymbols;\nexports.indexOf = indexOf;\nexports.isBuffer = isBuffer;","'use strict';\n\nexports.__esModule = true;\nexports.copyValue = exports.copyCollection = exports.copy = void 0;\n\nvar _polyfill = require('./polyfill');\n\nvar toString = Object.prototype.toString;\n\nfunction copy(target, customizer) {\n  var resultValue = copyValue(target);\n\n  if (resultValue !== null) {\n    return resultValue;\n  }\n\n  return copyCollection(target, customizer);\n}\n\nfunction copyCollection(target, customizer) {\n  if (typeof customizer !== 'function') {\n    throw new TypeError('customizer is must be a Function');\n  }\n\n  if (typeof target === 'function') {\n    var source = String(target);\n\n    // NOTE:\n    //\n    //   https://gist.github.com/jdalton/5e34d890105aca44399f\n    //\n    //   - https://gist.github.com/jdalton/5e34d890105aca44399f#gistcomment-1283831\n    //   - http://es5.github.io/#x15\n    //\n    //   native functions does not have prototype:\n    //\n    //       Object.toString.prototype  // => undefined\n    //       (function() {}).prototype  // => {}\n    //\n    //   but cannot detect native constructor:\n    //\n    //       typeof Object     // => 'function'\n    //       Object.prototype  // => {}\n    //\n    //   and cannot detect null binded function:\n    //\n    //       String(Math.abs)\n    //         // => 'function abs() { [native code] }'\n    //\n    //     Firefox, Safari:\n    //       String((function abs() {}).bind(null))\n    //         // => 'function abs() { [native code] }'\n    //\n    //     Chrome:\n    //       String((function abs() {}).bind(null))\n    //         // => 'function () { [native code] }'\n    if (/^\\s*function\\s*\\S*\\([^\\)]*\\)\\s*{\\s*\\[native code\\]\\s*}/.test(source)) {\n      // native function\n      return target;\n    } else {\n      // user defined function\n      return new Function('return ' + String(source))();\n    }\n  }\n\n  var targetClass = toString.call(target);\n\n  if (targetClass === '[object Array]') {\n    return [];\n  }\n\n  if (targetClass === '[object Object]' && target.constructor === Object) {\n    return {};\n  }\n\n  if (targetClass === '[object Date]') {\n    // NOTE:\n    //\n    //   Firefox need to convert\n    //\n    //   Firefox:\n    //     var date = new Date;\n    //     +date;            // 1420909365967\n    //     +new Date(date);  // 1420909365000\n    //     +new Date(+date); // 1420909365967\n    //\n    //   Chrome:\n    //     var date = new Date;\n    //     +date;            // 1420909757913\n    //     +new Date(date);  // 1420909757913\n    //     +new Date(+date); // 1420909757913\n    return new Date(target.getTime());\n  }\n\n  if (targetClass === '[object RegExp]') {\n    // NOTE:\n    //\n    //   Chrome, Safari:\n    //     (new RegExp).source => \"(?:)\"\n    //\n    //   Firefox:\n    //     (new RegExp).source => \"\"\n    //\n    //   Chrome, Safari, Firefox:\n    //     String(new RegExp) => \"/(?:)/\"\n    var regexpText = String(target),\n        slashIndex = regexpText.lastIndexOf('/');\n\n    return new RegExp(regexpText.slice(1, slashIndex), regexpText.slice(slashIndex + 1));\n  }\n\n  if ((0, _polyfill.isBuffer)(target)) {\n    var buffer = new Buffer(target.length);\n\n    target.copy(buffer);\n\n    return buffer;\n  }\n\n  var customizerResult = customizer(target);\n\n  if (customizerResult !== void 0) {\n    return customizerResult;\n  }\n\n  return null;\n}\n\nfunction copyValue(target) {\n  var targetType = typeof target;\n\n  // copy String, Number, Boolean, undefined and Symbol\n  // without null and Function\n  if (target !== null && targetType !== 'object' && targetType !== 'function') {\n    return target;\n  }\n\n  return null;\n}\n\nexports.copy = copy;\nexports.copyCollection = copyCollection;\nexports.copyValue = copyValue;","'use strict';\n\nexports.__esModule = true;\n\nvar _copy = require('./copy');\n\nvar _polyfill = require('./polyfill');\n\nfunction defaultCustomizer(target) {\n  return void 0;\n}\n\nfunction deepcopy(target) {\n  var customizer = arguments.length <= 1 || arguments[1] === void 0 ? defaultCustomizer : arguments[1];\n\n  if (target === null) {\n    // copy null\n    return null;\n  }\n\n  var resultValue = (0, _copy.copyValue)(target);\n\n  if (resultValue !== null) {\n    // copy some primitive types\n    return resultValue;\n  }\n\n  var resultCollection = (0, _copy.copyCollection)(target, customizer),\n      clone = resultCollection !== null ? resultCollection : target;\n\n  var visited = [target],\n      reference = [clone];\n\n  // recursively copy from collection\n  return recursiveCopy(target, customizer, clone, visited, reference);\n}\n\nfunction recursiveCopy(target, customizer, clone, visited, reference) {\n  if (target === null) {\n    // copy null\n    return null;\n  }\n\n  var resultValue = (0, _copy.copyValue)(target);\n\n  if (resultValue !== null) {\n    // copy some primitive types\n    return resultValue;\n  }\n\n  var keys = (0, _polyfill.getKeys)(target).concat((0, _polyfill.getSymbols)(target));\n\n  var i = void 0,\n      len = void 0;\n\n  var key = void 0,\n      value = void 0,\n      index = void 0,\n      resultCopy = void 0,\n      result = void 0,\n      ref = void 0;\n\n  for (i = 0, len = keys.length; i < len; ++i) {\n    key = keys[i];\n    value = target[key];\n    index = (0, _polyfill.indexOf)(visited, value);\n\n    resultCopy = void 0;\n    result = void 0;\n    ref = void 0;\n\n    if (index === -1) {\n      resultCopy = (0, _copy.copy)(value, customizer);\n      result = resultCopy !== null ? resultCopy : value;\n\n      if (value !== null && /^(?:function|object)$/.test(typeof value)) {\n        visited.push(value);\n        reference.push(result);\n      }\n    } else {\n      // circular reference\n      ref = reference[index];\n    }\n\n    clone[key] = ref || recursiveCopy(value, customizer, result, visited, reference);\n  }\n\n  return clone;\n}\n\nexports['default'] = deepcopy;\nmodule.exports = exports['default'];","module.exports = require('./lib');\n","'use strict';\n\nvar toStr = Object.prototype.toString;\n\nmodule.exports = function isArguments(value) {\n\tvar str = toStr.call(value);\n\tvar isArgs = str === '[object Arguments]';\n\tif (!isArgs) {\n\t\tisArgs = str !== '[object Array]' &&\n\t\t\tvalue !== null &&\n\t\t\ttypeof value === 'object' &&\n\t\t\ttypeof value.length === 'number' &&\n\t\t\tvalue.length >= 0 &&\n\t\t\ttoStr.call(value.callee) === '[object Function]';\n\t}\n\treturn isArgs;\n};\n","'use strict';\n\n// modified from https://github.com/es-shims/es5-shim\nvar has = Object.prototype.hasOwnProperty;\nvar toStr = Object.prototype.toString;\nvar slice = Array.prototype.slice;\nvar isArgs = require('./isArguments');\nvar isEnumerable = Object.prototype.propertyIsEnumerable;\nvar hasDontEnumBug = !isEnumerable.call({ toString: null }, 'toString');\nvar hasProtoEnumBug = isEnumerable.call(function () {}, 'prototype');\nvar dontEnums = [\n\t'toString',\n\t'toLocaleString',\n\t'valueOf',\n\t'hasOwnProperty',\n\t'isPrototypeOf',\n\t'propertyIsEnumerable',\n\t'constructor'\n];\nvar equalsConstructorPrototype = function (o) {\n\tvar ctor = o.constructor;\n\treturn ctor && ctor.prototype === o;\n};\nvar excludedKeys = {\n\t$console: true,\n\t$external: true,\n\t$frame: true,\n\t$frameElement: true,\n\t$frames: true,\n\t$innerHeight: true,\n\t$innerWidth: true,\n\t$outerHeight: true,\n\t$outerWidth: true,\n\t$pageXOffset: true,\n\t$pageYOffset: true,\n\t$parent: true,\n\t$scrollLeft: true,\n\t$scrollTop: true,\n\t$scrollX: true,\n\t$scrollY: true,\n\t$self: true,\n\t$webkitIndexedDB: true,\n\t$webkitStorageInfo: true,\n\t$window: true\n};\nvar hasAutomationEqualityBug = (function () {\n\t/* global window */\n\tif (typeof window === 'undefined') { return false; }\n\tfor (var k in window) {\n\t\ttry {\n\t\t\tif (!excludedKeys['$' + k] && has.call(window, k) && window[k] !== null && typeof window[k] === 'object') {\n\t\t\t\ttry {\n\t\t\t\t\tequalsConstructorPrototype(window[k]);\n\t\t\t\t} catch (e) {\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t} catch (e) {\n\t\t\treturn true;\n\t\t}\n\t}\n\treturn false;\n}());\nvar equalsConstructorPrototypeIfNotBuggy = function (o) {\n\t/* global window */\n\tif (typeof window === 'undefined' || !hasAutomationEqualityBug) {\n\t\treturn equalsConstructorPrototype(o);\n\t}\n\ttry {\n\t\treturn equalsConstructorPrototype(o);\n\t} catch (e) {\n\t\treturn false;\n\t}\n};\n\nvar keysShim = function keys(object) {\n\tvar isObject = object !== null && typeof object === 'object';\n\tvar isFunction = toStr.call(object) === '[object Function]';\n\tvar isArguments = isArgs(object);\n\tvar isString = isObject && toStr.call(object) === '[object String]';\n\tvar theKeys = [];\n\n\tif (!isObject && !isFunction && !isArguments) {\n\t\tthrow new TypeError('Object.keys called on a non-object');\n\t}\n\n\tvar skipProto = hasProtoEnumBug && isFunction;\n\tif (isString && object.length > 0 && !has.call(object, 0)) {\n\t\tfor (var i = 0; i < object.length; ++i) {\n\t\t\ttheKeys.push(String(i));\n\t\t}\n\t}\n\n\tif (isArguments && object.length > 0) {\n\t\tfor (var j = 0; j < object.length; ++j) {\n\t\t\ttheKeys.push(String(j));\n\t\t}\n\t} else {\n\t\tfor (var name in object) {\n\t\t\tif (!(skipProto && name === 'prototype') && has.call(object, name)) {\n\t\t\t\ttheKeys.push(String(name));\n\t\t\t}\n\t\t}\n\t}\n\n\tif (hasDontEnumBug) {\n\t\tvar skipConstructor = equalsConstructorPrototypeIfNotBuggy(object);\n\n\t\tfor (var k = 0; k < dontEnums.length; ++k) {\n\t\t\tif (!(skipConstructor && dontEnums[k] === 'constructor') && has.call(object, dontEnums[k])) {\n\t\t\t\ttheKeys.push(dontEnums[k]);\n\t\t\t}\n\t\t}\n\t}\n\treturn theKeys;\n};\n\nkeysShim.shim = function shimObjectKeys() {\n\tif (Object.keys) {\n\t\tvar keysWorksWithArguments = (function () {\n\t\t\t// Safari 5.0 bug\n\t\t\treturn (Object.keys(arguments) || '').length === 2;\n\t\t}(1, 2));\n\t\tif (!keysWorksWithArguments) {\n\t\t\tvar originalKeys = Object.keys;\n\t\t\tObject.keys = function keys(object) {\n\t\t\t\tif (isArgs(object)) {\n\t\t\t\t\treturn originalKeys(slice.call(object));\n\t\t\t\t} else {\n\t\t\t\t\treturn originalKeys(object);\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t} else {\n\t\tObject.keys = keysShim;\n\t}\n\treturn Object.keys || keysShim;\n};\n\nmodule.exports = keysShim;\n","module.exports = function (xs, f) {\n    if (xs.map) return xs.map(f);\n    var res = [];\n    for (var i = 0; i < xs.length; i++) {\n        var x = xs[i];\n        if (hasOwn.call(xs, i)) res.push(f(x, i, xs));\n    }\n    return res;\n};\n\nvar hasOwn = Object.prototype.hasOwnProperty;\n","import angular from 'angular'\r\nimport service from './service'\r\nimport httpDecorator from './httpDecorator'\r\nimport httpInterceptor from './httpInterceptor'\r\nimport cacheServiceAdapters from './cacheServiceAdapters'\r\n\r\nexport default angular\r\n  .module('http-etag', [])\r\n  .provider('httpEtag', service)\r\n  .config(cacheServiceAdapters)\r\n  .config(['$provide', '$httpProvider', function addHttpEtagInterceptor ($provide, $httpProvider) {\r\n    httpDecorator.useLegacyPromiseExtensions =\r\n      $httpProvider.useLegacyPromiseExtensions ||\r\n      function useLegacyPromiseExtensions () { return true }\r\n    $provide.decorator('$http', httpDecorator)\r\n    $httpProvider.interceptors.push(httpInterceptor)\r\n  }])\r\n  .name\r\n"],"names":["httpEtagProvider","this","serviceAdapterMethods","cacheAdapterMethods","requiredAdapterMethods","concat","cacheAdapters","cacheDefinitions","defaultCacheId","defaultEtagCacheConfig","deepCopy","cacheResponseData","cacheService","cacheOptions","number","setDefaultCacheConfig","config","angular","extend","getDefaultCacheConfig","defineCache","cacheId","id","defineCacheServiceAdapter","serviceName","Error","methods","forEach","method","getCacheServiceAdapter","$get","$injector","processCacheId","type","isDefined","httpEtagService","services","adaptedServices","caches","adaptedCaches","adapter","service","window","get","adaptedService","bind","createCache","cache","getCache","adaptedCache","serviceDeepCopies","storesDeepCopies","copy","value","deepcopy","wrappedMethod","wrappedRawMethod","adapterMethod","itemKey","options","cachedData","responseData","$getItem","unsetItem","setItem","undefined","expireItem","data","etagHeader","$setItem","getItemCache","info","isCache","itemCache","methodMappings","itemCacheInfo","isItemCache","purgeCaches","removeAllItems","httpEtagHttpDecorator","$delegate","httpEtag","$httpDecorator","httpConfig","httpEtagPromiseFactory","httpPromise","then","success","cached","callback","isCachable","rawCacheData","cacheInfo","useLegacyPromiseExtensions","cachedResponse","status","headers","successCallback","errorCallback","progressBackCallback","httpEtagSuccessWrapper","response","httpEtagErrorWrapper","thenPromise","apply","partializedCallback","partial","hasConfig","etagCache","isCacheableMethod","cachableHttpMethods","indexOf","etagCacheConfig","processHttpConfigEtagValue","cachedEtag","$$_itemCache","If-None-Match","$http","arguments","etagValue","etagValueType","generateCacheItemKey","url","params","stringifyParams","joiner","queryString","obj","arrayMap","objectKeys","sort","key","val","isArray","val2","encodeURIComponent","join","fn","args","Array","prototype","slice","call","arg","i","length","httpMethod","toLowerCase","httpEtagInterceptorFactory","responseInterceptor","etag","cacheData","$set","cacheAdaptersConfig","$cacheFactory","put","getItem","removeItem","remove","removeAll","noop","localStorage","JSON","stringify","e","parse","keyPrefix","sessionStorage","array","s","toString","TypeError","len","exports","Object","isBuffer","Buffer","getKeys","keys","objType","resultKeys","hasOwnProperty","push","getSymbols","Symbol","getOwnPropertySymbols","target","customizer","resultValue","copyValue","copyCollection","source","String","test","Function","targetClass","constructor","Date","getTime","regexpText","slashIndex","lastIndexOf","RegExp","_polyfill","buffer","customizerResult","targetType","require$$0","defaultCustomizer","_copy","resultCollection","clone","visited","reference","recursiveCopy","index","resultCopy","result","ref","require$$1","module","toStr","str","isArgs","callee","has","isEnumerable","propertyIsEnumerable","hasDontEnumBug","hasProtoEnumBug","dontEnums","equalsConstructorPrototype","o","ctor","excludedKeys","$console","$external","$frame","$frameElement","$frames","$innerHeight","$innerWidth","$outerHeight","$outerWidth","$pageXOffset","$pageYOffset","$parent","$scrollLeft","$scrollTop","$scrollX","$scrollY","$self","$webkitIndexedDB","$webkitStorageInfo","$window","hasAutomationEqualityBug","k","equalsConstructorPrototypeIfNotBuggy","keysShim","object","isObject","isFunction","isArguments","isString","theKeys","skipProto","j","name","skipConstructor","shim","keysWorksWithArguments","originalKeys","xs","f","map","res","x","hasOwn","$inject","provider","cacheServiceAdapters","$provide","$httpProvider","httpDecorator","decorator","interceptors","httpInterceptor"],"mappings":"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"}